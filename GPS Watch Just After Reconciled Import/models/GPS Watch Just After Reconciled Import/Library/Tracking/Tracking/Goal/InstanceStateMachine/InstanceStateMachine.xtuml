-- BP 7.1.6 content: InstanceStateMachine syschar: 3 persistence-version: 7.1.6

INSERT INTO SM_ISM
	VALUES ("f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"f285cd20-04b6-4d70-aa8a-8f5dd8363aed");
INSERT INTO SM_SM
	VALUES ("f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	'',
	0);
INSERT INTO SM_MOORE
	VALUES ("f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_LEVT
	VALUES ("8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEVT
	VALUES ("8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_EVT
	VALUES ("8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	1,
	'Completed',
	0,
	'',
	'Goal1',
	'Indicates that execution of this goal has been completed.  ');
INSERT INTO SM_LEVT
	VALUES ("66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEVT
	VALUES ("66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_EVT
	VALUES ("66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	2,
	'Evaluate',
	0,
	'',
	'Goal2',
	'Indicates that this goal should be evaluated for completeness and achievement.');
INSERT INTO SM_LEVT
	VALUES ("e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEVT
	VALUES ("e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_EVT
	VALUES ("e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	3,
	'Pause',
	0,
	'',
	'Goal3',
	'');
INSERT INTO SM_STATE
	VALUES ("cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'Executing',
	1,
	0);
INSERT INTO SM_SEME
	VALUES ("cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEME
	VALUES ("cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEME
	VALUES ("cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_STATE
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'Completed',
	2,
	0);
INSERT INTO SM_EIGN
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO SM_SEME
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_EIGN
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO SM_SEME
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_CH
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO SM_SEME
	VALUES ("2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_STATE
	VALUES ("cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'Paused',
	3,
	0);
INSERT INTO SM_SEME
	VALUES ("cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_SEME
	VALUES ("cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_CH
	VALUES ("cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO SM_SEME
	VALUES ("cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_NSTXN
	VALUES ("d2e7bd74-0eaf-4e85-98c1-de6f3d9bbe82",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_TXN
	VALUES ("d2e7bd74-0eaf-4e85-98c1-de6f3d9bbe82",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_NSTXN
	VALUES ("878d81c7-e825-4496-9221-21f9d7e50173",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_TXN
	VALUES ("878d81c7-e825-4496-9221-21f9d7e50173",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_NSTXN
	VALUES ("461c95e9-ea56-4352-b708-c63776db0a15",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"e594bdd3-cd93-4f82-afdc-97ba31510bf6",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_TXN
	VALUES ("461c95e9-ea56-4352-b708-c63776db0a15",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_NSTXN
	VALUES ("825e86b3-31b7-49ca-96c9-39f43a3d843a",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"66aa9184-605d-45f6-898f-a1f560b80b60",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_TXN
	VALUES ("825e86b3-31b7-49ca-96c9-39f43a3d843a",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_NSTXN
	VALUES ("d07d114a-9a7e-4a08-821c-bd89c51980bb",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cc3a26aa-ee90-422e-9fb8-a29f36f8e06f",
	"8ed8ccc5-21c7-4907-a2b8-e3ba2ce9af8c",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_TXN
	VALUES ("d07d114a-9a7e-4a08-821c-bd89c51980bb",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"2e818033-2f53-46f3-a0f9-ac01f2095dc1",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO SM_MOAH
	VALUES ("6809c1c8-acdb-4e92-8c00-fc762ef22adf",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cbd1b772-da65-407f-8cb6-5ebaf1a2f5f9");
INSERT INTO SM_AH
	VALUES ("6809c1c8-acdb-4e92-8c00-fc762ef22adf",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("6809c1c8-acdb-4e92-8c00-fc762ef22adf",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'// Determine whether this goal is currently being achieved.
disposition = self.evaluateAchievement();

// Update achievement records if necessary.  There are four cases:
//   0. Still not achieving this goal. 
//   1. Just started achieving this goal.
//   2. Just stopped achieving this goal.
//   3. Still achieving this goal.
// For cases 0 and 3, there is nothing to be done for achievement records.
// Case 1 requires the creation of a new achievment record, storing the start time.
// Case 2 requires the storing of the end time for the open achievement record.
if ( (self.disposition != GoalDisposition::Achieving) and (disposition == GoalDisposition::Achieving) )
  // Case 1, create achievement record, store start time, relate it as open record.
  create object instance achievement of Achievement;
  relate self to achievement across R14.''has open'';
  select one workoutTimer related by 
    self->WorkoutSession[R11.''is currently executing within'']->WorkoutTimer[R8.''is timed by''];
  achievement.startTime = workoutTimer.time;
elif ( (self.disposition == GoalDisposition::Achieving) and (disposition != GoalDisposition::Achieving) )
  // Case 2, store end time, relate as recorded record, unrelate as open record.
  select one achievement related by self->Achievement[R14.''has open''];
  achievement.close();
end if;

// Update disposition of this goal.
self.disposition = disposition;

// Determine whether execution of this goal is complete, 
//  and if so, advance to the next one if it exists.
self.evaluateCompletion();',
	'');
INSERT INTO SM_MOAH
	VALUES ("30e9e2fa-b3c0-4b44-8356-47bccf21bb84",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"2e818033-2f53-46f3-a0f9-ac01f2095dc1");
INSERT INTO SM_AH
	VALUES ("30e9e2fa-b3c0-4b44-8356-47bccf21bb84",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("30e9e2fa-b3c0-4b44-8356-47bccf21bb84",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'// Stop executing this goal and begin executing the next one, if there is one.

// Stop the goal-evaluation timer, ignoring the return code which indicates 
//   whether a timer event was in flight when the timer was cancelled.
cancelSucceeded = TIM::timer_cancel( timer_inst_ref: self.evaluationTimer );

// If this goal has an open achievement record, close it.
select one openAchievement related by self->Achievement[R14.''has open''];
if ( not empty openAchievement )
  openAchievement.close();
end if;

// Add this goal to the collection of those that have already executed.
select one session related by self->WorkoutSession[R11.''is currently executing within''];
relate self to session across R13.''was executed within'';

// Remove this goal from the collection of currently executing ones.
unrelate self from session across R11.''is currently executing within'';

// Find the next goal specification in the sequence and start executing it, if it exists.
select one currentGoalSpec related by self->GoalSpec[R9.''specified by''];

select any nextGoalSpec related by session->GoalSpec[R10.''includes'']
  where ( selected.sequenceNumber == (currentGoalSpec.sequenceNumber + 1) );
  
if ( not empty nextGoalSpec )
  Goal::create( sequenceNumber: nextGoalSpec.sequenceNumber );
end if;
',
	'');
INSERT INTO SM_MOAH
	VALUES ("7680aeaf-77f8-455b-97bc-bfcfbe035130",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"cc3a26aa-ee90-422e-9fb8-a29f36f8e06f");
INSERT INTO SM_AH
	VALUES ("7680aeaf-77f8-455b-97bc-bfcfbe035130",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("7680aeaf-77f8-455b-97bc-bfcfbe035130",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'// Deactivate evaluation timer, ignoring the return code because this 
//   state model ignores any latent timer events.
cancelSucceeded = TIM::timer_cancel( timer_inst_ref: self.evaluationTimer );',
	'');
INSERT INTO SM_TAH
	VALUES ("970213c1-7547-45b1-bad8-66334d0d88f0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"d2e7bd74-0eaf-4e85-98c1-de6f3d9bbe82");
INSERT INTO SM_AH
	VALUES ("970213c1-7547-45b1-bad8-66334d0d88f0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("970213c1-7547-45b1-bad8-66334d0d88f0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'',
	'');
INSERT INTO SM_TAH
	VALUES ("43b1951d-1a1a-4b9a-8813-6667844185f7",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"878d81c7-e825-4496-9221-21f9d7e50173");
INSERT INTO SM_AH
	VALUES ("43b1951d-1a1a-4b9a-8813-6667844185f7",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("43b1951d-1a1a-4b9a-8813-6667844185f7",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'',
	'');
INSERT INTO SM_TAH
	VALUES ("748a5345-d3f7-4ce9-bcad-ff6b0343d9c0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"461c95e9-ea56-4352-b708-c63776db0a15");
INSERT INTO SM_AH
	VALUES ("748a5345-d3f7-4ce9-bcad-ff6b0343d9c0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("748a5345-d3f7-4ce9-bcad-ff6b0343d9c0",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	3,
	'',
	'');
INSERT INTO SM_TAH
	VALUES ("7c1f30c7-652f-4b5b-8681-1390a15830cb",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"825e86b3-31b7-49ca-96c9-39f43a3d843a");
INSERT INTO SM_AH
	VALUES ("7c1f30c7-652f-4b5b-8681-1390a15830cb",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("7c1f30c7-652f-4b5b-8681-1390a15830cb",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	1,
	'// Start a timer that periodically causes evaluation of goal achievement.
create event instance evaluateEvent of Goal2:Evaluate to self;
self.evaluationTimer = TIM::timer_start_recurring( event_inst: evaluateEvent, microseconds: evaluationPeriod );',
	'');
INSERT INTO SM_TAH
	VALUES ("14f9e802-19c7-4f78-8922-c40401e8d445",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	"d07d114a-9a7e-4a08-821c-bd89c51980bb");
INSERT INTO SM_AH
	VALUES ("14f9e802-19c7-4f78-8922-c40401e8d445",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991");
INSERT INTO SM_ACT
	VALUES ("14f9e802-19c7-4f78-8922-c40401e8d445",
	"f3ff21f7-eb5c-43a2-93ac-9a1b97da7991",
	3,
	'',
	'');
INSERT INTO O_OBJ_PROXY
	VALUES ("f285cd20-04b6-4d70-aa8a-8f5dd8363aed",
	'Goal',
	9,
	'Goal',
	'Each instance represents a particular goal as it is executing.
This class knows how to evaluate whether the goal is being achieved 
and whether the goal has completed.',
	"00000000-0000-0000-0000-000000000000",
	'../Goal.xtuml');
