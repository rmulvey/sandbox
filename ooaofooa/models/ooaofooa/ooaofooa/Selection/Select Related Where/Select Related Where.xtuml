-- BP 7.1.6 content: ModelClass syschar: 3 persistence-version: 7.1.6

INSERT INTO O_OBJ
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	'Select Related Where',
	604,
	'ACT_SRW',
	'This class represents a statement that selects a set of instances related across one or more associations with the support of a where clause.  The where clause consists of a boolean expression containing the special instance handle ''selected''. If the expression evaluates to true, the instance represented by ''selected '' is added to the result set of the statement.
',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TFR
	VALUES ("30730b25-914e-4e0e-87fa-95ec027afc2b",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	'execute',
	'',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'// Select Related Where.execute()
select one body related by self->ACT_SEL[R664]->ACT_SMT[R603]->ACT_BLK[R602]->ACT_ACT[R601];
select any stack_frame from instances of I_STF where 
                                selected.Stack_Frame_ID == param.stack_frame_id;
if (empty stack_frame)
	//Invalid stack frame ID!
	pathMsg = "<No Path Available - Empty instance>";
    if (not_empty body)
      pathMsg = body.getPath();
    end if;
	USER::logError(msg:"Error in Select Related Where.execute: Invalid stack frame id used. Using random top stack frame.",path:pathMsg);
	select any stack from instances of I_STACK;
	select one stack_frame related by stack->I_STF[R2929];
end if;
select one seln related by self->ACT_SEL[R664];
select any sel_ref related by stack_frame->I_BSF[R2923]->
                                                     L_LCL[R3000]->L_LSR[R3001];
if (empty sel_ref)
  // If there isn''t one, create it and link it to the outer block
  select one outer_block related by self->ACT_SEL[R664]->ACT_SMT[R603]->
                                    ACT_BLK[R602]->ACT_ACT[R601]->ACT_BLK[R666];
  ref_ID = outer_block.newLocalSelectedReference(stack_frame_id:
                                                    stack_frame.Stack_Frame_ID);
  select any sel_ref related by stack_frame->I_BSF[R2923]->L_LCL[R3000]->
                               L_LSR[R3001] where (selected.Local_ID == ref_ID);
end if;
select any selection_local_reference related by seln->V_VAR[R638]->V_INT[R814]->L_LCR[R3004];
// If this is a many call, then selection_local_reference will be empty, and we should overwrite it with the correct value
if(seln.cardinality == "many")
  select any selection_local_reference related by seln->V_VAR[R638]->V_INS[R814]->L_LCR[R3003];
end if;
select one selection_rv related by selection_local_reference->
                      L_LCL[R3001]->RV_RVL[R3306]->RV_SMV[R3300]->RV_IRV[R3308];
select one inst_ref related by sel_ref->L_IWC[R3006];
if (empty inst_ref)
  // Set up the instance set for iteration
  sel_ref_initialized = false;
  select many insts related by selection_rv->L_IIR[R3311]->I_INS[R3013];
  select any prev_inst_in_where from instances of L_IWC;
  for each inst in insts
    create object instance inst_in_where of L_IWC;
    relate inst to inst_in_where across R3014;
    if (sel_ref_initialized == false)
      // The old selection reference is no longer valid, dispose it
      select one old_inst_ref related by sel_ref->L_IWC[R3006];
      if (not_empty old_inst_ref)
        old_inst_ref.dispose();
      end if;
      // Point the selection reference to the first instance
      relate inst_in_where to sel_ref across R3006;
      inst_ref = inst_in_where;
      sel_ref_initialized = true;
    else
      // Chain the instances together
      relate inst_in_where to prev_inst_in_where across R3016.''is after'';
    end if;
    prev_inst_in_where = inst_in_where;
  end for;
end if;
select one where_clause related by self->V_VAL[R611];
where_clause.computeValue(stack_frame_id: stack_frame.Stack_Frame_ID);
select any result related by stack_frame->I_VSF[R2951] where
                                     selected.Value_ID == where_clause.Value_ID;
select one rtVal related by result->RV_RVL[R3305];
if (empty rtVal)
  // result requires computation. Return and let the new stack frame execute
  return;      
end if;
stack_frame.popValue(value_id:where_clause.Value_ID);
select one inst_in_where related by sel_ref->L_IWC[R3006];
if (not_empty inst_in_where)
  selectionPassed = GD::instance_to_boolean(value:rtVal.getValue());
  if (not selectionPassed)
    // The filter was false, remove the candidate instance from the result
    select any inst_in_ref related by inst_in_where->
                                           I_INS[R3014]->L_IIR[R3013] where
                       selected.RuntimeValue_ID == selection_rv.RuntimeValue_ID;
    inst_in_ref.dispose();
  end if;
  select one next_inst_in_where related by inst_in_where->
                                                       L_IWC[R3016.''is before''];
  unrelate inst_in_where from sel_ref across R3006;
  // We''ve visited this instance, dispose the reference
  inst_in_where.dispose();
  if (seln.cardinality == "many" or not selectionPassed)
    if (not_empty next_inst_in_where)
      relate next_inst_in_where to sel_ref across R3006;
    end if;
  else
    // We got our result and we''re done, dispose all remaining references
    while (not_empty next_inst_in_where)
      select one next_next_inst_in_where related by inst_in_where->
                                                       L_IWC[R3016.''is before''];
      next_inst_in_where.dispose();
      next_inst_in_where = next_next_inst_in_where;
    end while;
  end if;
end if;',
	1,
	'',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TPARM
	VALUES ("9e4f6d08-f42e-4eea-8b9f-41f70a044599",
	"30730b25-914e-4e0e-87fa-95ec027afc2b",
	'stack_frame_id',
	"ba5eda7a-def5-0000-0000-000000000005",
	0,
	'',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO O_REF
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	"b1a1c65e-e119-4b5d-9356-c493fdaada15",
	0,
	"94bf419b-d5d2-4c27-b9d1-8e4f7d60833a",
	"297921f7-8ce5-4139-9058-3e4ff315fbd3",
	"9756933c-2ffd-498f-b3fa-7750644b2f7f",
	"046d9bb6-3443-4858-b610-4e6f6ccb6098",
	"c6c6379f-ae6f-4033-bd09-86bb442a1fa4",
	"bdab169f-97e8-465d-970f-233c2ff324f3",
	"00000000-0000-0000-0000-000000000000",
	0,
	'',
	'Select',
	'Statement_ID',
	'R664');
INSERT INTO R_RGO_PROXY
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	"297921f7-8ce5-4139-9058-3e4ff315fbd3",
	"9756933c-2ffd-498f-b3fa-7750644b2f7f",
	'../Selection.xtuml');
INSERT INTO O_RTIDA_PROXY
	VALUES ("94bf419b-d5d2-4c27-b9d1-8e4f7d60833a",
	"b1a1c65e-e119-4b5d-9356-c493fdaada15",
	0,
	"297921f7-8ce5-4139-9058-3e4ff315fbd3",
	"046d9bb6-3443-4858-b610-4e6f6ccb6098",
	'../Selection.xtuml');
INSERT INTO O_RATTR
	VALUES ("c6c6379f-ae6f-4033-bd09-86bb442a1fa4",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	"9bdc49e0-583c-4741-ad6c-fa52d80977a5",
	"4f42b756-0c2e-4a87-b40f-87291682433c",
	1,
	'Statement_ID');
INSERT INTO O_BATTR_PROXY
	VALUES ("9bdc49e0-583c-4741-ad6c-fa52d80977a5",
	"4f42b756-0c2e-4a87-b40f-87291682433c",
	'../../Body/Statement/Statement.xtuml');
INSERT INTO O_ATTR
	VALUES ("c6c6379f-ae6f-4033-bd09-86bb442a1fa4",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	"00000000-0000-0000-0000-000000000000",
	'Statement_ID',
	'

',
	'',
	'Statement_ID',
	0,
	"ba5eda7a-def5-0000-0000-000000000007",
	'',
	'');
INSERT INTO O_REF
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	"43ea4f47-4fe8-4167-8153-9e199477d0fd",
	0,
	"6e185a42-0dc6-4b9d-9d4b-38cb7c8aa772",
	"699f59eb-9e69-4ed7-ba51-b8641d9d42ba",
	"ddaa9128-2699-4231-9939-a5cedd88d770",
	"db4a61b2-6489-4d32-96a6-173bb2613fa8",
	"593ddef6-3049-4093-b60b-02b5281e7b8b",
	"f537af57-a85f-42e9-a08e-e78a51d259ab",
	"00000000-0000-0000-0000-000000000000",
	0,
	'',
	'Value',
	'Value_ID',
	'R611.''where clause''');
INSERT INTO R_RGO_PROXY
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	"699f59eb-9e69-4ed7-ba51-b8641d9d42ba",
	"ddaa9128-2699-4231-9939-a5cedd88d770",
	'../Selection.xtuml');
INSERT INTO O_RTIDA_PROXY
	VALUES ("6e185a42-0dc6-4b9d-9d4b-38cb7c8aa772",
	"43ea4f47-4fe8-4167-8153-9e199477d0fd",
	0,
	"699f59eb-9e69-4ed7-ba51-b8641d9d42ba",
	"db4a61b2-6489-4d32-96a6-173bb2613fa8",
	'../Selection.xtuml');
INSERT INTO O_RATTR
	VALUES ("593ddef6-3049-4093-b60b-02b5281e7b8b",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	"6e185a42-0dc6-4b9d-9d4b-38cb7c8aa772",
	"43ea4f47-4fe8-4167-8153-9e199477d0fd",
	1,
	'Value_ID');
INSERT INTO O_BATTR_PROXY
	VALUES ("6e185a42-0dc6-4b9d-9d4b-38cb7c8aa772",
	"43ea4f47-4fe8-4167-8153-9e199477d0fd",
	'../../Value/Value/Value.xtuml');
INSERT INTO O_ATTR
	VALUES ("593ddef6-3049-4093-b60b-02b5281e7b8b",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	"c6c6379f-ae6f-4033-bd09-86bb442a1fa4",
	'Where_Clause_Value_ID',
	'',
	'Where_Clause_',
	'Value_ID',
	1,
	"ba5eda7a-def5-0000-0000-000000000007",
	'',
	'');
INSERT INTO O_ID
	VALUES (0,
	"86738e1f-56f7-4da5-8ade-e01278d8c997");
INSERT INTO O_OIDA
	VALUES ("c6c6379f-ae6f-4033-bd09-86bb442a1fa4",
	"86738e1f-56f7-4da5-8ade-e01278d8c997",
	0,
	'Statement_ID');
INSERT INTO O_ID
	VALUES (1,
	"86738e1f-56f7-4da5-8ade-e01278d8c997");
INSERT INTO O_ID
	VALUES (2,
	"86738e1f-56f7-4da5-8ade-e01278d8c997");
INSERT INTO PE_PE
	VALUES ("86738e1f-56f7-4da5-8ade-e01278d8c997",
	1,
	"506c7424-c813-4e1c-8551-b157c3aa6f07",
	"00000000-0000-0000-0000-000000000000",
	4);
INSERT INTO EP_PKG_PROXY
	VALUES ("506c7424-c813-4e1c-8551-b157c3aa6f07",
	"00000000-0000-0000-0000-000000000000",
	"2f3ea6a7-20e9-405c-b68c-7fba041e7daf",
	'Selection',
	'This subsystem captures concepts related to selections of instances across associations. Association chain, where and instance extent selections are also covered.
Notify_Changes:false
Persistent:false
// This is used by schema_gen to ignore this subsystem (for publication)
TRANSLATE_FOR_EXTERNAL_USE:FALSE
',
	600,
	'../Selection.xtuml');
