-- BP 7.1.6 content: ModelClass syschar: 3 persistence-version: 7.1.6

INSERT INTO O_OBJ
	VALUES ("68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	'Action Language Engine',
	9501,
	'SEN_ALE',
	'',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TFR
	VALUES ("a53a09e2-a3b3-460c-b678-81393b5979c5",
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	'processQuery',
	'',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'// for each participant associated we apply the given pattern
// for any matches we create the necessary results
select any query from instances of SQU_Q where (selected.Id == param.queryId);
select one engine related by self->SEN_E[R9501];
select many participants related by engine->SP_SP[R9502];
for each participant in participants
  select one actionLanguageParticipant related by participant->SP_SE[R9700]
                                                                ->SP_ALS[R9702];
  if(not_empty actionLanguageParticipant)
    // cache a variable for the singleton result
    // used for this participant
    select any searchResult from instances of SR_SR 
                                    where (selected.Id == GD::NULL_UNIQUE_ID());
    // should not be empty, but no harm in checking
    contents = actionLanguageParticipant.searchableValue;
    // process this call in a while loop, the call will return
    // a negative value when no more matches exist
    result = 0;
    while(result >= 0)
      matchResultId = Search::locateContentResults(pattern:query.pattern,
                        contents:contents, isCaseSensitive:query.caseSensitive);
      select any matchResult from instances of SR_CMR
                                           where (selected.Id == matchResultId);
      if(not_empty matchResult)
        result = matchResult.startPosition;
        if(result >= 0)
          // create a search result
          if(empty searchResult)
            create object instance searchResult of SR_SR;
            relate searchResult to engine across R9503;
            relate searchResult to participant across R9802;
          end if;
          // create a match
          create object instance match of SR_M;
          create object instance contentMatch of SR_CM;
          relate match to contentMatch across R9801;
          relate searchResult to match across R9800;
          contentMatch.startPosition = matchResult.startPosition;
          contentMatch.matchLength = matchResult.length;
          delete object instance matchResult;
          // send creation notification
          Search::matchCreated(match:match.convertToInstance());
        end if;
      else
        // no match found, set result to -1
        result = -1;
      end if;
      // if the passed in progress monitor indicates
      // that the user has cancelled this search, then
      // end all processing
      if(Search::monitorCanceled(monitor:param.monitor))
        Search::clearQueryData();
        return;
      end if;
    end while;
    Search::clearQueryData();
  end if;
end for;',
	1,
	'',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TPARM
	VALUES ("ecde1d1a-df79-472b-88be-0763150b1fef",
	"a53a09e2-a3b3-460c-b678-81393b5979c5",
	'queryId',
	"ba5eda7a-def5-0000-0000-000000000005",
	0,
	'',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO O_TPARM
	VALUES ("966a666b-908b-4d05-a55a-ce182939013a",
	"a53a09e2-a3b3-460c-b678-81393b5979c5",
	'monitor',
	"a5d8b590-a627-4af4-afdf-152c889769b6",
	0,
	'',
	"ecde1d1a-df79-472b-88be-0763150b1fef",
	'');
INSERT INTO S_DT_PROXY
	VALUES ("a5d8b590-a627-4af4-afdf-152c889769b6",
	"00000000-0000-0000-0000-000000000000",
	'instance',
	'',
	'',
	'../../../Datatypes/Datatypes.xtuml');
INSERT INTO O_REF
	VALUES ("68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	"06e79e8f-eeae-474d-902b-14c7e6d59fd5",
	0,
	"85b09010-dd3d-40e9-a7ba-53eb65a53aaf",
	"5f6d217f-2958-40bd-8988-990cf2dec37f",
	"7e8b138f-d697-40be-92f4-6eb5c6593305",
	"2a5d445b-2af3-49ea-ba4e-0231839a7ae3",
	"d07632a4-d2b0-429e-8f7a-06d6f278e5e0",
	"e2e9094e-a465-4c82-a0d0-f6053a1c848f",
	"00000000-0000-0000-0000-000000000000",
	0,
	'',
	'Search Engine',
	'Id',
	'R9501');
INSERT INTO R_RGO_PROXY
	VALUES ("68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	"5f6d217f-2958-40bd-8988-990cf2dec37f",
	"7e8b138f-d697-40be-92f4-6eb5c6593305",
	'../Engine.xtuml');
INSERT INTO O_RTIDA_PROXY
	VALUES ("85b09010-dd3d-40e9-a7ba-53eb65a53aaf",
	"06e79e8f-eeae-474d-902b-14c7e6d59fd5",
	0,
	"5f6d217f-2958-40bd-8988-990cf2dec37f",
	"2a5d445b-2af3-49ea-ba4e-0231839a7ae3",
	'../Engine.xtuml');
INSERT INTO O_RATTR
	VALUES ("d07632a4-d2b0-429e-8f7a-06d6f278e5e0",
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	"85b09010-dd3d-40e9-a7ba-53eb65a53aaf",
	"06e79e8f-eeae-474d-902b-14c7e6d59fd5",
	1,
	'Id');
INSERT INTO O_BATTR_PROXY
	VALUES ("85b09010-dd3d-40e9-a7ba-53eb65a53aaf",
	"06e79e8f-eeae-474d-902b-14c7e6d59fd5",
	'../Search Engine/Search Engine.xtuml');
INSERT INTO O_ATTR
	VALUES ("d07632a4-d2b0-429e-8f7a-06d6f278e5e0",
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	"00000000-0000-0000-0000-000000000000",
	'Id',
	'',
	'',
	'Id',
	0,
	"ba5eda7a-def5-0000-0000-000000000007",
	'',
	'');
INSERT INTO O_ID
	VALUES (0,
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41");
INSERT INTO O_OIDA
	VALUES ("d07632a4-d2b0-429e-8f7a-06d6f278e5e0",
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	0,
	'Id');
INSERT INTO O_ID
	VALUES (1,
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41");
INSERT INTO O_ID
	VALUES (2,
	"68b42d04-3f06-4e2f-a1ed-06133ff0df41");
INSERT INTO PE_PE
	VALUES ("68b42d04-3f06-4e2f-a1ed-06133ff0df41",
	1,
	"3f875493-bba5-4247-aa6a-3f757827542b",
	"00000000-0000-0000-0000-000000000000",
	4);
INSERT INTO EP_PKG_PROXY
	VALUES ("3f875493-bba5-4247-aa6a-3f757827542b",
	"00000000-0000-0000-0000-000000000000",
	"2f3ea6a7-20e9-405c-b68c-7fba041e7daf",
	'Engine',
	'',
	9500,
	'../Engine.xtuml');
